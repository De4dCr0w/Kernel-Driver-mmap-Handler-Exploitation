#include <stdlib.h>
#include <stdio.h>
#include <sys/mman.h>
#include <sys/types.h>
#include <fcntl.h>
#include <stdint.h>
#include <unistd.h>

void hexDump(unsigned char *buf, int len)
{
    int i;  
  
    for(i = 0 ;i <len ;i+=4)  
    {  
        if(i%16 == 0)  
    	{  
        	printf("\n");  
			printf("%04x ",i);
        }  
       printf(" %02x%02x%02x%02x",buf[i],buf[i+1],buf[i+2],buf[i+3]);
    } 
	printf("\n"); 
}

int main(int argc, char * const * argv) 
{ 
	printf("[+] PID: %d\n",getpid());
	int fd = open("/dev/MWR_DEVICE_Fault", O_RDONLY); 
	if (fd < 0) 
	{ 
		printf("[-] Open failed!\n"); 
		return -1; 
	} 
	printf("[+] Open OK fd: %d\n",fd);

	unsigned long size = 0x10000;
	unsigned long mmapStart = 0x42424000;

	unsigned int * addr = (unsigned int *)mmap((void*)mmapStart, size, PROT_READ, MAP_SHARED, fd, 0x0); 
	printf("addr: %lx\n",addr);
	if (addr == MAP_FAILED) 
	{ 
		perror("Failed to mmap: "); 
		close(fd); 
		return -1; 
	} 
	printf("[+] mmap OK addr: %lx\n", addr); 
	hexDump(addr, 0x8000); // Dump mapped buffer
	
	getchar();
	return 0; 
}
